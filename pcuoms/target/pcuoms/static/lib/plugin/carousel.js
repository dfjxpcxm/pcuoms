;(function($){var Carousel=function(poster,opt){this.animateStopFlag=true;var self=this;this.poster=poster;this.setting={"width":1000,"height":270,"posterWidth":640,"posterHeight":270,"verticalAlign":'middle',"autoPlay":true,"speed":500,"delay":500,"scale":0.9},$.extend(this.setting,opt,this.getSetting());this.posterItemMain=poster.find("ul.poster-list");this.nextBtn=poster.find("div.poster-next-btn");this.prevBtn=poster.find("div.poster-prev-btn");this.posterItem=poster.find("li.list-item");if(this.posterItem.size()%2==0){this.posterItemMain.append(this.posterItem.eq(0).clone());this.posterItem=this.posterItemMain.children();}
this.posterFirstItem=this.posterItem.first();this.posterLastItem=this.posterItem.last();this.setSettingValue();this.setPosterPos();this.nextBtn.click(function(){if(self.animateStopFlag){self.animateStopFlag=false;self.carouselRotate('left');}});this.prevBtn.click(function(){if(self.animateStopFlag){self.animateStopFlag=false;self.carouselRotate('right');}});if(this.setting.autoPlay){this.autoPlay();this.poster.hover(function(){window.clearInterval(self.timer);},function(){self.autoPlay();});}};Carousel.prototype={getSetting:function(){var setting=this.poster.attr('data-setting');if(setting&&setting!=''){return $.parseJSON(setting);}else{return{};}},setSettingValue:function(){this.poster.css({width:this.setting.width,height:this.setting.height});this.posterItemMain.css({width:this.setting.width,height:this.setting.height});var w=(this.setting.width-this.setting.posterWidth)/2;this.nextBtn.css({width:w,height:this.setting.height,zIndex:Math.ceil(this.posterItem.size()/2)});this.prevBtn.css({width:w,height:this.setting.height,zIndex:Math.ceil(this.posterItem.size()/2)});this.posterFirstItem.css({width:this.setting.posterWidth,height:this.setting.posterHeight,left:w,zIndex:Math.floor(this.posterItem.size()/2)});},setPosterPos:function(){var self=this;var sliceItem=this.posterItem.slice(1),sliceSize=sliceItem.size()/2,rightSlice=sliceItem.slice(0,sliceSize)
level=Math.floor(this.posterItem.size()/2);var rw=self.setting.posterWidth,rh=self.setting.posterHeight,gap=((self.setting.width-self.setting.posterWidth)/2)/level;var firstLeft=(self.setting.width-self.setting.posterWidth)/2;var fixOffsetLeft=firstLeft+rw;rightSlice.each(function(i){level--;rw=rw*self.setting.scale;rh=rh*self.setting.scale;var j=i;$(this).css({width:rw,height:rh,zIndex:level,opacity:1/(++j),left:fixOffsetLeft+(++i)*gap-rw,top:self.setVertucalAlign(rh)});});var leftSlice=sliceItem.slice(sliceSize);var leftSliceSize=leftSlice.size();var oloop=leftSlice.size();var lw=rightSlice.last().width(),lh=rightSlice.last().height(),lz=rightSlice.last().css('zIndex');leftSlice.each(function(i){$(this).css({width:lw,height:lh,zIndex:lz++,opacity:1/oloop--,left:i*gap,top:self.setVertucalAlign(lh)});lw=lw/self.setting.scale;lh=lh/self.setting.scale;});},setVertucalAlign:function(height){var verticalType=this.setting.verticalAlign,top=0;if(verticalType=='top'){top=0;}else if(verticalType=='middle'){top=(this.setting.height-height)/2;}else if(verticalType=='bottom'){top=this.setting.height-height;}else{top=(this.setting.height-height)/2;}
return top;},carouselRotate:function(dir){var _this_=this;if(dir==='left'){var zIndexArr=[];this.posterItem.each(function(){var curPoster=$(this),prevPoster=curPoster.prev().get(0)?curPoster.prev():_this_.posterLastItem,width=prevPoster.width(),height=prevPoster.height(),zIndex=prevPoster.css('zIndex'),opacity=prevPoster.css('opacity'),top=prevPoster.css('top');left=prevPoster.css('left');zIndexArr.push(zIndex);curPoster.animate({width:width,height:height,opacity:opacity,top:top,left:left},_this_.setting.speed,function(){_this_.animateStopFlag=true;});});this.posterItem.each(function(i){$(this).css('zIndex',zIndexArr[i]);});}
if(dir==='right'){var zIndexArr=[];this.posterItem.each(function(){var curPoster=$(this),nextPoster=curPoster.next().get(0)?curPoster.next():_this_.posterFirstItem,width=nextPoster.width(),height=nextPoster.height(),zIndex=nextPoster.css('zIndex'),opacity=nextPoster.css('opacity'),top=nextPoster.css('top');left=nextPoster.css('left');zIndexArr.push(zIndex);curPoster.animate({width:width,height:height,opacity:opacity,top:top,left:left},_this_.setting.speed,function(){_this_.animateStopFlag=true;});});this.posterItem.each(function(i){$(this).css('zIndex',zIndexArr[i]);});}},autoPlay:function(){var _this_=this;this.timer=window.setInterval(function(){_this_.prevBtn.click();},this.setting.delay);}};Carousel.init=function(posters,opt){var _this_=this;posters.each(function(){new _this_($(this),opt);});}
window['Carousel']=Carousel;})(jQuery);